openapi: 3.0.3
info:
  title: Small KMS Shared Models
  version: 0.1.1
paths: {}
components:
  schemas:
    CertificateRef:
      allOf:
        - $ref: "#/components/schemas/ResourceRef"
        - $ref: "#/components/schemas/CertificateRefFields"
        - x-go-type: certificateRefComposed
    CertificateRefFields:
      type: object
      properties:
        subjectCommonName:
          description: Common name
          type: string
        notAfter:
          description: Expiration date of the certificate
          type: string
          format: date-time
        template:
          $ref: "#/components/schemas/ResourceLocator"
        isIssued:
          description: Whether the certificate has been issued
          type: boolean
      required:
        - thumbprint
        - subjectCommonName
        - notAfter
        - template
        - isIssued
    Identifier:
      type: string
      x-go-type: identifierImpl
    JwkAlg:
      type: string
      enum:
        - RS256
        - RS384
        - RS512
        - ES256
        - ES384
      x-enum-varnames:
        - AlgRS256
        - AlgRS384
        - AlgRS512
        - AlgES256
        - AlgES384
    JwtKty:
      type: string
      enum:
        - RSA
        - EC
      x-enum-varnames:
        - KeyTypeRSA
        - KeyTypeEC
    JwkProperties:
      type: object
      description: Property bag of JSON Web Key (RFC 7517) with additional fields, all bytes are base64url encoded
      properties:
        alg:
          $ref: "#/components/schemas/JwkAlg"
        kty:
          $ref: "#/components/schemas/JwtKty"
        key_size:
          description: RSA key size
          type: integer
          format: int32
        n:
          description: RSA modulus
          type: string
          x-go-type: Base64RawURLEncodableBytes
          x-go-type-skip-optional-pointer: true
        e:
          description: RSA exponent
          type: string
          x-go-type: Base64RawURLEncodableBytes
          x-go-type-skip-optional-pointer: true
        x:
          description: EC x coordinate
          type: string
          x-go-type: Base64RawURLEncodableBytes
          x-go-type-skip-optional-pointer: true
        y:
          description: EC y coordinate
          type: string
          x-go-type: Base64RawURLEncodableBytes
          x-go-type-skip-optional-pointer: true
        kid:
          description: Key ID
          type: string
          x-go-name: KeyID
        x5u:
          x-go-name: CertificateURL
          description: X.509 certificate URL
          type: string
        x5c:
          description: X.509 certificate chain
          type: array
          items:
            type: string
            x-go-type: Base64RawURLEncodableBytes
          x-go-name: CertificateChain
          x-go-type-skip-optional-pointer: true
        x5t:
          description: X.509 certificate SHA-1 thumbprint
          type: string
          x-go-type: Base64RawURLEncodableBytes
          x-go-name: CertificateThumbprint
          x-go-type-skip-optional-pointer: true
        x5t#S256:
          description: X.509 certificate SHA-256 thumbprint
          type: string
          x-go-type: Base64RawURLEncodableBytes
          x-go-name: CertificateThumbprintSHA256
          x-go-type-skip-optional-pointer: true
      required:
        - kty
    NamespaceIdentifier:
      type: string
      x-go-type: identifierWithKind[NamespaceKind]
    NamespaceKind:
      type: string
      enum:
        - profile
        - ca-root
        - ca-int
        - service-principal
        - group
        - device
        - user
        - application
        - managed-app
      x-enum-varnames:
        - NamespaceKindProfile
        - NamespaceKindCaRoot
        - NamespaceKindCaInt
        - NamespaceKindServicePrincipal
        - NamespaceKindGroup
        - NamespaceKindDevice
        - NamespaceKindUser
        - NamespaceKindApplication
        - NamespaceKindManagedApp
    ResourceIdentifier:
      type: string
      x-go-type: identifierWithKind[ResourceKind]
    ResourceKind:
      type: string
      enum:
        - reserved
        - ca-root
        - ca-int
        - ms-graph
        - app
        - cert-template
        - cert
        - latest-cert-for-template
        - agent-config
        - agent-callback
      x-enum-varnames:
        - ResourceKindReserved
        - ResourceKindCaRoot
        - ResourceKindCaInt
        - ResourceKindMsGraph
        - ResourceKindApp
        - ResourceKindCertTemplate
        - ResourceKindCert
        - ResourceKindAgentConfig
        - ResourceKindAgentCallback
    ResourceLocator:
      type: string
      x-go-type: locator[NamespaceKind, ResourceKind]
    ResourceRef:
      type: object
      properties:
        id:
          x-go-name: ID
          $ref: "#/components/schemas/Identifier"
        locator:
          $ref: "#/components/schemas/ResourceLocator"
        updated:
          description: Time when the resoruce was last updated
          type: string
          format: date-time
        updatedBy:
          type: string
        deleted:
          description: Time when the deleted was deleted
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
          x-go-type-skip-optional-pointer: true
      required:
        - id
        - locator
    SubjectAlternativeNames:
      type: object
      properties:
        dnsNames:
          type: array
          items:
            type: string
          x-go-type-skip-optional-pointer: true
          x-go-name: DNSNames
        ipAddresses:
          type: array
          items:
            type: string
            x-go-type: net.IP
          x-go-type-skip-optional-pointer: true
          x-go-name: IPAddresses
        emails:
          type: array
          items:
            type: string
          x-go-type-skip-optional-pointer: true
    TemplatedCertificateTag:
      type: string
      enum:
        - latest
        - primary
        - secondary
      x-enum-varnames:
        - CertificateTagLatest
        - CertificateTagPrimary
        - CertificateTagSecondary
    WellknownCertificateTemplateName:
      type: string
      enum:
        - default
        - default-intranet-access
        - default-ms-entra-client-creds
        - default-mtls
      x-enum-varnames:
        - CertTemplateNameDefault
        - CertTemplateNameDefaultIntranetAccess
        - CertTemplateNameDefaultMsEntraClientCreds
        - CertTemplateNameDefaultMtls
