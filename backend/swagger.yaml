openapi: 3.0.3
info:
  title: Small KMS Admin API
  version: 0.1.0
servers:
  - url: http://localhost:9000
    description: Local server
paths:
  /admin/ca:
    get:
      tags:
        - admin
      summary: List CA Certificates
      operationId: ListCACertificates
      parameters:
        - $ref: "#/components/parameters/MsClientPrincipalName"
        - $ref: "#/components/parameters/MsClientPrincipalId"
        - $ref: "#/components/parameters/MsClientRoles"
      responses:
        "200":
          description: A JSON array of Certificate Refs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CertificateRefs"
  /admin/ca/{id}:
    post:
      tags:
        - admin
      summary: Create CA Certificate
      operationId: CreateCACertificate
      parameters:
        - $ref: "#/components/parameters/MsClientPrincipalName"
        - $ref: "#/components/parameters/MsClientPrincipalId"
        - $ref: "#/components/parameters/MsClientRoles"
        - in: query
          name: force
          schema:
            type: boolean
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCertificateParameters"
      responses:
        "200":
          description: Certificate metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CertificateRef"
components:
  parameters:
    MsClientPrincipalName:
      in: header
      name: X-Ms-Client-Principal-Name
      schema:
        type: string
      required: true
    MsClientPrincipalId:
      in: header
      name: X-Ms-Client-Principal-Id
      schema:
        type: string
      required: true
    MsClientRoles:
      in: header
      name: X-Ms-Client-Roles
      schema:
        type: string
      required: true
  schemas:
    CertificateRefs:
      type: array
      items:
        $ref: "#/components/schemas/CertificateRef"
    CertificateRef:
      type: object
      properties:
        id:
          description: Unique ID of the certificate
          type: string
          format: uuid
          x-go-name: ID
        commonName:
          type: string
        serialNumber:
          type: string
          format: hex
        enabled:
          type: boolean
        notBefore:
          type: string
          format: date-time
        notAfter:
          type: string
          format: date-time
        issuerId:
          type: string
          format: uuid
          x-go-name: IssuerID
      required:
        - id
        - commonName
        - serialNumber
        - notBefore
        - notAfter
        - issuerId
    CreateCertificateParameters:
      type: object
      properties:
        category:
          type: string
          enum:
            - root-ca
            - intermediate-ca
            - server
            - client
        name:
          type: string
        subject:
          type: string
        validity:
          type: string
          format: duration
        kty:
          type: string
          enum:
            - RSA
            - EC
        size:
          type: integer
          format: int32
          enum:
            - 2048
            - 3072
            - 4096
        curve:
          type: string
          enum:
            - P-256
            - P-384
        issuer:
          type: string
          format: uuid
          x-go-name: IssuerID
      required:
        - category
        - name
        - subject
